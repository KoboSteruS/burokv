# Защита админ-панели Django

## Описание

Админ-панель Django защищена через JWT токен в URL. Доступ возможен только по специальной ссылке с токеном.

## Настройка

### 1. Добавьте секретный ключ в `.env`:

```env
ADMIN_JWT_SECRET=ваш-уникальный-секретный-ключ-минимум-32-символа
```

**Генерация секретного ключа:**
```bash
python -c "import secrets; print(secrets.token_urlsafe(32))"
```

### 2. Установите зависимости:

```bash
pip install PyJWT>=2.8.0
```

### 3. Генерация JWT токена для доступа:

```bash
python manage.py generate_admin_token
```

Или с указанием срока действия:
```bash
python manage.py generate_admin_token --expires-days 365
```

Команда выведет URL для доступа к админ-панели:
```
http://your-domain.com/admin/eyJ0eXAiOiJKV1QiLCJhbGc...
```

### 4. Использование токена:

Скопируйте полный URL с токеном и используйте его для доступа к админ-панели.

**Пример:**
```
http://194.87.234.99/admin/eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ0eXBlIjoiYWRtaW5fYWNjZXNzIiwiZXhwIjoxNzM2MDAwMDAwfQ.xxx/
```

## Безопасность

### ⚠️ ВАЖНО:

1. **Никогда не делитесь токеном** с третьими лицами
2. **Храните токен в безопасном месте** (менеджер паролей)
3. **Регулярно обновляйте токен** (генерируйте новый)
4. **Используйте HTTPS** в production для защиты токена при передаче
5. **Ограничьте доступ по IP** дополнительно через Nginx/firewall

### Дополнительные меры безопасности:

1. **Ограничение по IP в Nginx:**
```nginx
location /admin/ {
    allow 192.168.1.0/24;  # Разрешенные IP
    deny all;
    proxy_pass http://127.0.0.1:8000;
}
```

2. **Двухфакторная аутентификация:**
   - Используйте django-otp для дополнительной защиты

3. **Регулярная ротация токенов:**
   - Генерируйте новый токен каждые 3-6 месяцев

## Отключение защиты (только для разработки)

Если нужно временно отключить защиту (НЕ рекомендуется в production):

1. Уберите `ADMIN_JWT_SECRET` из `.env`
2. Или закомментируйте middleware в `settings.py`

## Обновление токена

Если токен истек или скомпрометирован:

1. Сгенерируйте новый токен:
```bash
python manage.py generate_admin_token
```

2. Обновите закладку/ссылку на новый URL

## Troubleshooting

### Ошибка: "Доступ запрещен. Требуется JWT токен в URL."

- Убедитесь, что используете полный URL с токеном
- Проверьте, что токен не истек
- Проверьте правильность `ADMIN_JWT_SECRET` в `.env`

### Ошибка: "Токен истек"

- Сгенерируйте новый токен командой `generate_admin_token`
- Используйте новый URL для доступа

### Ошибка: "Невалидный токен"

- Проверьте, что токен скопирован полностью
- Убедитесь, что `ADMIN_JWT_SECRET` не изменился
- Сгенерируйте новый токен

